/*! This is hwcrypto.js 0.0.7 2015-03-28 */
var hwcrypto=function(){"use strict";function a(a){return navigator.mimeTypes&&a in navigator.mimeTypes?!0:!1}function b(a){return"function"==typeof window[a]?!0:!1}function c(a){if("string"==typeof a){var b=new Uint8Array(Math.floor(a.length/2)),c=0;return a.replace(/(..)/g,function(a){b[c++]=parseInt(a,16)}),b}}function d(a){for(var b="",c=0;c<a.length;c++)b+=(a[c]<16?"0":"")+a[c].toString(16);return b.toLowerCase()}function e(a){return"hwc"+a.replace("/","").replace("-","")}function f(a){var b=e(a);if(document.getElementById(b))return console.log("Plugin element already loaded"),document.getElementById(b);console.log("Loading plugin for "+a+" into "+b);var c=document.createElement("object");return c.setAttribute("id",b),c.setAttribute("type",a),c.setAttribute("width","1"),c.setAttribute("height","1"),document.body.appendChild(c),c}function g(){var c="probe() detected ";b(n)&&console.log(c+n),a(m)&&console.log(c+m)}function h(){function a(a){switch(console.log("Error: "+a+" with: "+c.errorMessage),parseInt(a)){case 1:return o;case 2:return q;case 17:return q;case 19:return t;default:return console.log("Unknown error: "+a+" with: "+c.errorMessage),r}}function b(b){return new Error(a(b))}this._name="NPAPI/BHO for application/x-digidoc";var c=f(m),d={};this.check=function(){return"undefined"!=typeof c.version?!0:!1},this.getVersion=function(){return new Promise(function(a){var b=c.version;a(b)})},this.getCertificate=function(a){return a&&a.lang&&(c.pluginLanguage=a.lang),new Promise(function(a,e){try{var f=c.getCertificate();0!==parseInt(c.errorCode)?e(b(c.errorCode)):(d[f.cert]=f.id,a({hex:f.cert}))}catch(g){console.log(g),e(b(c.errorCode))}})},this.sign=function(a,e,f){return new Promise(function(g,h){var i=d[a.hex];if(i)try{var j=f.lang||"en",k=c.sign(i,e.hex,j);g({hex:k})}catch(l){console.log(JSON.stringify(l)),h(b(c.errorCode))}else console.log("invalid certificate: "+a),h(new Error(q))})}}function i(){this._name="Chrome native messaging extension";var a=null;this.check=function(){return b(n)?(a=new window[n],a?!0:!1):!1},this.getVersion=function(){return a.getVersion()},this.getCertificate=function(b){return a.getCertificate(b)},this.sign=function(b,c,d){return a.sign(b,c,d)}}function j(){this._name="No implementation",this.check=function(){return!0},this.getVersion=function(){return Promise.reject(new Error(s))},this.getCertificate=function(){return Promise.reject(new Error(s))},this.sign=function(){return Promise.reject(new Error(s))}}function k(a){var b=new a;return b.check()?(console.log("Using backend: "+a.name),u=b,!0):(console.log(a.name+" check() failed"),!1)}function l(){return console.log("Autodetecting best backend"),-1==navigator.userAgent.indexOf("MSIE")&&-1==navigator.userAgent.indexOf("Trident")||(console.log("Assuming IE BHO, testing"),!k(h))?-1!=navigator.userAgent.indexOf("Chrome")&&b(n)&&k(i)?!0:a(m)&&k(h)?!0:k(j):!0}console.log("hwcrypto.js activated");var m="application/x-digidoc",n="TokenSigning",o="user_cancel",p="no_certificates",q="invalid_argument",r="technical_error",s="no_implementation",t="not_allowed";window.addEventListener("load",function(){g()});var u=null,v={};return v.use=function(a){return void 0===typeof a||"auto"===a?l():"chrome"===a?k(i):"npapi"===a?k(h):!1},v.debug=function(){return new Promise(function(a){var b="hwcrypto.js 0.0.7";u||l(),u.getVersion().then(function(c){a(b+" with "+u._name+" "+c)},function(){a(b+" with failing backend "+u._name)})})},v.getCertificate=function(a){return"object"!=typeof a?(console.log("getCertificate options parameter must be an object"),Promise.reject(new Error(q))):(a&&!a.lang&&(a.lang="en"),u||l(),"https:"!==location.protocol&&"file:"!==location.protocol?Promise.reject(new Error(t)):u.getCertificate(a).then(function(a){return a.hex&&!a.encoded&&(a.encoded=c(a.hex)),a}))},v.sign=function(a,b,e){return arguments.length<2?Promise.reject(new Error(q)):(e&&!e.lang&&(e.lang="en"),b.type&&(b.value||b.hex)?(b.hex&&!b.value&&(console.log("DEPRECATED: hash.hex as argument to sign() is deprecated, use hash.value instead"),b.value=c(b.hex)),b.value&&!b.hex&&(b.hex=d(b.value)),u||l(),"https:"!==location.protocol&&"file:"!==location.protocol?Promise.reject(new Error(t)):u.sign(a,b,e).then(function(a){return a.hex&&!a.value&&(a.value=c(a.hex)),a})):Promise.reject(new Error(q)))},v.NO_IMPLEMENTATION=s,v.USER_CANCEL=o,v.NOT_ALLOWED=t,v.NO_CERTIFICATES=p,v.TECHNICAL_ERROR=r,v.INVALID_ARGUMENT=q,v}();